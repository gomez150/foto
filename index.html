
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tarea: Foto con Voz</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background: #f2f2f2;
			margin: 0;
			padding: 0;
			display: flex;
			flex-direction: column;
			align-items: center;
			min-height: 100vh;
		}
		h1 {
			margin-top: 20px;
			font-size: 1.5em;
		}
		#video, #canvas {
			border: 2px solid #888;
			margin: 10px 0;
			background: #fff;
		}
		#descargar {
			margin-top: 10px;
			padding: 8px 16px;
			font-size: 1em;
			background: #4caf50;
			color: #fff;
			border: none;
			cursor: pointer;
		}
		#descargar:disabled {
			background: #aaa;
			cursor: not-allowed;
		}
		#mensaje {
			margin: 10px;
			color: #333;
		}
	</style>
</head>
<body>
	<h1>Captura de Foto por Voz</h1>
	<video id="video" width="320" height="240" autoplay></video>
	<canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
	<div id="mensaje">Di <b>foto</b> para capturar una imagen.</div>
	<button id="descargar" disabled>Descargar Foto</button>
	<script>
		// Acceso a la webcam
		const video = document.getElementById('video');
		const canvas = document.getElementById('canvas');
		const ctx = canvas.getContext('2d');
		const btnDescargar = document.getElementById('descargar');
		const mensaje = document.getElementById('mensaje');
		let fotoTomada = false;

		navigator.mediaDevices.getUserMedia({ video: true, audio: false })
			.then(stream => {
				video.srcObject = stream;
			})
			.catch(err => {
				mensaje.textContent = 'No se pudo acceder a la cámara.';
			});

		// Reconocimiento de voz
		let reconocimiento;
		try {
			const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
			reconocimiento = new SpeechRecognition();
			reconocimiento.lang = 'es-ES';
			reconocimiento.continuous = true;
			reconocimiento.interimResults = false;
		} catch (e) {
			mensaje.textContent = 'Tu navegador no soporta reconocimiento de voz.';
		}

		if (reconocimiento) {
			reconocimiento.onresult = function(event) {
				for (let i = event.resultIndex; i < event.results.length; ++i) {
					if (event.results[i].isFinal) {
						const texto = event.results[i][0].transcript.trim().toLowerCase();
						if (texto.includes('foto')) {
							tomarFoto();
						}
					}
				}
			};
			reconocimiento.onerror = function() {
				mensaje.textContent = 'Error en el reconocimiento de voz.';
			};
			reconocimiento.start();
		}

		function tomarFoto() {
			ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
			canvas.style.display = 'block';
			fotoTomada = true;
			btnDescargar.disabled = false;
			mensaje.textContent = '¡Foto tomada! Puedes descargarla.';
		}

		btnDescargar.addEventListener('click', function() {
			if (!fotoTomada) return;
			const enlace = document.createElement('a');
			enlace.href = canvas.toDataURL('image/png');
			enlace.download = 'foto.png';
			enlace.click();
		});
	</script>
</body>
</html>
